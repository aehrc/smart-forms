---
sidebar_position: 4
---

import IframeContainer from '../../src/react/IframeContainer';

# Calculations

Calculations are used to dynamically calculate the value of a question based on the values of other questions.

The extensions that fall under this category are:

- [variable](http://hl7.org/fhir/uv/sdc/expressions.html#variable)
- [calculatedExpression](http://hl7.org/fhir/uv/sdc/expressions.html#calculatedExpression)
- [cqf-expression](http://hl7.org/fhir/uv/sdc/behavior.html#cqf-expression)

### Variable

Used to define a variable that is available for use in [expressions](http://hl7.org/fhir/uv/sdc/expressions.html) within the same item and any descendant items. This allows it to be consumed by calculatedExpressions when the renderer executes a calculation.

For more information, refer to http://hl7.org/fhir/uv/sdc/expressions.html#variable.

For usages, refer to the [CalculatedExpression](#calculatedexpression) section on this page.

### CalculatedExpression

The basis of calculations in SDC. Allows an item value to update continuously as the answers to dependent questions change.
In Smart Forms, calculated expressions are driven by [FHIRPath](https://hl7.org/fhir/fhirpath.html).

Not all components support calculated expressions. The following components support calculated expressions:

| Components | Limitations                                                                                                                                                |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| boolean    | -                                                                                                                                                          |
| decimal    | -                                                                                                                                                          |
| integer    | -                                                                                                                                                          |
| string     | -                                                                                                                                                          |
| text       | -                                                                                                                                                          |
| choice     | Only supports the following [itemControls](https://hl7.org/fhir/extensions/CodeSystem-questionnaire-item-control.html):<br/>- radio-button<br/>- drop-down |

#### Basic usage

Basic usage examples are covered in the respective components:

- [boolean](/docs/components/boolean#advanced-usage)
- [decimal](/docs/components/decimal#advanced-usage)
- [integer](/docs/components/integer#advanced-usage)
- [string](/docs/components/string#advanced-usage)
- [text](/docs/components/text#advanced-usage)
- [choice (answerOption)](/docs/components/choice#advanced-usage)
- [choice (answerValueSet)](/docs/components/choice#advanced-usage)

#### BMI Calculation usage

<IframeContainer
  storyId="sdc-9-1-3-form-behavior-calculations--calculated-expression-bmi-calculator"
  initialHeight={352}
/>

#### Absolute Cardiovascular Risk Calculation usage

<IframeContainer
  storyId="sdc-9-1-3-form-behavior-calculations--calculated-expression-cvd-risk-calculator"
  initialHeight={1168}
/>

### Cqf-expression

- [x] cqf-expression

While calculated expressions are used to update the value of a question dynamically, cqf-expression is used to update the elements/controls within the Questionnaire resource itself during render runtime.

**Key Features:**

- **Patient Data Access**: Use `%patient` to access patient information
- **Form Data Access**: Use `%resource` to access current form responses
- **System Variables**: Use `now()` for current timestamp, etc.
- **Conditional Logic**: Use `iif()` for conditional expressions
- **String Operations**: Concatenation, substring, and other string functions

**Usage:**

- Place the extension in the `_text.extension` property of questionnaire items
- Use FHIRPath expressions to access patient data, form responses, and system variables
- Supports conditional logic, calculations, and dynamic content generation

**Supported Elements:**
At the moment, the only supported element/control is **text**.

#### Basic CQF Expression

<IframeContainer
  storyId="sdc-cqf-expression-extension--simple-cqf-expression"
  initialHeight={400}
/>

#### Advanced CQF Expression

<IframeContainer storyId="sdc-cqf-expression-extension--basic-cqf-expression" initialHeight={500} />

#### Complex CQF Expression

<IframeContainer
  storyId="sdc-cqf-expression-extension--advanced-cqf-expression"
  initialHeight={600}
/>
