{
    "resourceType": "Questionnaire",
    "id": "cvd-risk",
    "meta": {
        "profile": [
            "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-render",
            "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-pop-smap",
            "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-extr-obsn"
        ]
    },
    "text": {
        "status": "generated",
        "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><b>CVD Risk Assessment</b></div>"
    },
    "contained": [
        {
            "resourceType": "Bundle",
            "id": "PrePopQuery",
            "type": "batch",
            "entry": [
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52553",
                    "request": {
                        "method": "GET",
                        "url": "FamilyMemberHistory?patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52554",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=72166-2&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52555",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=8302-2&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52556",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=8280-0&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52557",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=29463-7&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52558",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=8867-4&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52559",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=39156-5&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52560",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=85354-9&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52561",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=72166-2&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52562",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=160625004&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52563",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=smoking-date-started&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52564",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=229819007&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52565",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=160573003&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52566",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=228308009&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52567",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=1373041000168105&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52568",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=160573003&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52569",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=60621009&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52570",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=absolute-cvd-risk&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52571",
                    "request": {
                        "method": "GET",
                        "url": "Immunization?patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52572",
                    "request": {
                        "method": "GET",
                        "url": "MedicationStatement?patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52573",
                    "request": {
                        "method": "GET",
                        "url": "AllergyIntolerance?patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52575",
                    "request": {
                        "method": "GET",
                        "url": "Condition?patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52574",
                    "request": {
                        "method": "GET",
                        "url": "DiagnosticReport?patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52576",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=14647-2&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                },
                {
                    "fullUrl": "urn:uuid:38a25157-b8e4-42e4-9525-7954fed52577",
                    "request": {
                        "method": "GET",
                        "url": "Observation?code=14646-4&_count=1&_sort=-date&patient={{%LaunchPatient.id}}"
                    }
                }
            ]
        }
    ],
    "extension": [
        {
            "extension": [
                {
                    "url": "name",
                    "valueId": "LaunchPatient"
                },
                {
                    "url": "type",
                    "valueCode": "Patient"
                },
                {
                    "url": "description",
                    "valueString": "The patient that is to be used to pre-populate the form"
                }
            ],
            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-launchContext"
        },
        {
            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-sourceQueries",
            "valueReference": {
                "reference": "#PrePopQuery"
            }
        }
    ],
    "url": "http://www.health.gov.au/assessments/cvd-risk",
    "name": "CVD Risk Assessment",
    "title": "CVD Risk Assessment",
    "status": "active",
    "subjectType": [
        "Patient"
    ],
    "date": "2020-02-25T07:14:23.125Z",
    "publisher": "Frankel Info Systems",
    "description": "CVD Risk Assessment",
    "item": [
    {
        "linkId": "CVD-risk",
        "text": "Cardiovascular Disease Risk",
        "type": "group",
        "item": [
            {
                "extension": [
                    {
                        "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                        "valueExpression": {
                            "language": "text/fhirpath",
                            "expression": "today().toString().substring(0,4).toInteger() - %LaunchPatient.birthDate.toString().substring(0,4).toInteger()"
                        }
                    }
                ],
                "linkId": "age",
                "text": "Age of Patient",
                "type": "integer"
            },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%LaunchPatient.gender"
                            }
                        }
                    ],
                    "linkId": "gender",
                    "text": "Gender",
                    "type": "choice",
                    "answerOption": [ { "valueCoding": { "code": "male", "display": "Male", "system": "http://hl7.org/fhir/administrative-gender" }}, 
                        { "valueCoding": { "code": "female", "display": "Female", "system": "http://hl7.org/fhir/administrative-gender" }}]
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%LaunchPatient.extension('http://hl7.org.au/fhir/StructureDefinition/indigenous-status').value.where(code='1' or code='2' or code='3').exists()"
                            }
                        }
                    ],
                    "linkId": "aboriginal-tsi",
                    "text": "Aboriginal or Torres Strait Islander",
                    "type": "boolean",
                    "repeats": false
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[21].resource.entry.resource.code.coding.where(system='http://snomed.info/sct' and code='44054006').exists()"
                            }
                        }
                    ],
                    "linkId": "has-diabetes",
                    "text": "Diabetes",
                    "type": "boolean",
                    "repeats": false
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[1].resource.entry.resource.valueCodeableConcept.coding.where(system='http://snomed.info/sct' and code='77176002').exists()"
                            }
                        }
                    ],
                    "linkId": "current-smoker",
                    "text": "Current smoker",
                    "type": "boolean",
                    "repeats": false
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[2].resource.entry.resource.value.value"
                            }
                        }
                    ],
                    "linkId": "height",
                    "text": "Height (cm)",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[4].resource.entry.resource.value.value"
                            }
                        }
                    ],
                    "linkId": "weight",
                    "text": "Weight (kg)",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[6].resource.entry.resource.value.value"
                            }
                        }
                    ],
                    "linkId": "bmi",
                    "text": "Body mass index",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[3].resource.entry.resource.value.value"
                            }
                        }
                    ],
                    "linkId": "waist-circumference",
                    "text": "Waist circumference (cm)",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[7].resource.entry.resource.component.where(code.coding.where(code='8459-0')).value.value"
                            }
                        }
                    ],
                    "linkId": "systolic-bp",
                    "text": "Systolic Blood Pressure",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[19].resource.entry.resource.contained[0].code.coding.where(system='http://www.whocc.no/atc' and code.startsWith('C02')).exists()"
                            }
                        }
                    ],
                    "linkId": "bp-lowering-med",
                    "text": "BP loweing medication",
                    "type": "boolean",
                    "repeats": false
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[23].resource.entry.resource.value.value"
                            }
                        }
                    ],
                    "linkId": "tot-chol",
                    "text": "Total Cholesterol",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                            "valueExpression": {
                                "language": "text/fhirpath",
                                "expression": "%PrePopQuery.entry[24].resource.entry.resource.value.value"
                            }
                        }
                    ],
                    "linkId": "hdl-chol",
                    "text": "HDL Cholesterol",
                    "type": "decimal"
                },
                {
                    "extension": [
                        {
                            "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-instruction",
                            "valueString": "auscvdrisk.com.au/risk-calculator/"
                        },
                        {
                            "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-unit",
                            "valueCoding": { "system": "http://unitsofmeasure.org", "code": "%" }
                        },
                        {
                            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-observationExtract", 
                            "valueBoolean": "true"
                        }
                    ],
                    "linkId": "cvd-risk",
                    "text": "Cardiovascular risk calculated, details",
                    "code": [{"code": "827181004", "display": "Risk of cardiovascular disease", "system":"http://snomed.info/sct" }],
                    "type": "decimal"
                }
            ]
        }
    ]
}